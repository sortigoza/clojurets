!function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);throw(f=new Error("Cannot find module '"+i+"'")).code="MODULE_NOT_FOUND",f}c=n[i]={exports:{}},e[i][0].call(c.exports,function(r){return o(e[i][1][r]||r)},c,c.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.clojure=void 0;var reader_1=require("./reader"),evaluator_1=require("./evaluator"),events_1=require("./events"),require=require("./namespace"),reader=new reader_1.Reader;exports.clojure={run:function(str){return str=reader.read(str),events_1.events.publish("BEGIN_RUN_EVALUATION",{data:str}),str=evaluator_1.evaluator.evaluate(str),events_1.events.publish("FINISH_RUN_EVALUATION",{result:str}),str},events:events_1.events,namespace:require.Namespace},"undefined"!=typeof window&&(window.clojurejs=exports.clojure)},{"./evaluator":2,"./events":3,"./namespace":6,"./reader":7}],2:[function(require,module,exports){!function(global){!function(){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.evaluator=exports.SpecialForms=void 0;var namespace_1=require("./namespace"),forms_1=require("./forms"),events_1=require("./events"),literal=(forms_1.forms.number,forms_1.forms.string,forms_1.forms.literal),symbol=forms_1.forms.symbol,hash_map=forms_1.forms.hash_map,vector=forms_1.forms.vector,call=(forms_1.forms.list,forms_1.forms.call),MAX_ITERATIONS=1e3,Evaluator=function(){function Evaluator(){}return Evaluator.prototype.evaluate=function(exprs,context){context=context||namespace_1.Namespace.current;for(var _i=0,exprs_1=exprs;_i<exprs_1.length;_i++)var result=evaluateExpression(exprs_1[_i],context);return void 0===result?literal(null):result},Evaluator}();function evaluateExpression(form,context){return function(fn,form,context){try{events_1.events.publish("BEGIN_EVALUATE_EXPRESSION",{form:form,context:context});var result=fn(form,context);return events_1.events.publish("FINISH_EVALUATE_EXPRESSION",{form:form,context:context,result:result}),result}catch(e){throw events_1.events.publish("EVALUATE_EXPRESSION_FAILED",{form:form,context:context}),e}}(_evaluateExpression,form,context)}function _evaluateExpression(form,context){for(var should_continue,name,count=0;;){if(form.quoted)return form;switch(form.kind){case literal.kind:return literal("true"===(name=form.value)||"false"!==name&&("nil"===name?null:void 0));case symbol.kind:return function(name,namespace,context){var symbol;return[lookupQualifiedSymbol,lookupSpecialForm,lookupContextSymbol,lookupWindowSymbol,lookupGlobalSymbol,throwLookupError].find(function(lookup){return void 0!==(symbol=lookup.call(this,name,namespace,context))}),symbol}(form.value,form.namespace,context);case vector.kind:return vector.apply(forms_1.forms,form.value.map(function(e){return evaluateExpression(e,context)}));case hash_map.kind:return hash_map.apply(forms_1.forms,form.value.map(function(e){return evaluateExpression(e,context)}));case call.kind:switch(form.value[0].value){case"if":form=SpecialForms.tailCallIf(form,context);continue;case"cond":form=SpecialForms.tailCallCond(form,context);continue;case"fn":return SpecialForms.fn(form,context);case"def":return SpecialForms.def(form,context);case"let":return SpecialForms.let(form,context.extend());case"throw":return SpecialForms.throw(form,context);case"try":return SpecialForms.try(form,context)}if(form=(name=function(form,context){var func=evaluateExpression(form.value[0],context),args=form.value.slice(1);func.macro||(args=args.map(function(arg){return evaluateExpression(arg,context)}));if(func.program_defined)return func.params.value.map(function(arg,i){context.set(arg.value,args[i])}),void 0===(form=func.exprs)?[literal(null),!1,context]:[form,!0,context];return[("function"==typeof func?func:func.value).apply(context,args),!1,context]}(form,context.extend()))[0],should_continue=name[1],context=name[2],should_continue&&count<MAX_ITERATIONS){count++;continue}return count===MAX_ITERATIONS&&console.log({msg:"max evaluations reached!",count:count}),form;default:return form}}}var SpecialForms=function(){function SpecialForms(){}return SpecialForms.tailCallIf=function(form,context){context=evaluateExpression(form.value[1],context);return null!==context.value&&!1!==context.value?form.value[2]:form.value[3]},SpecialForms.tailCallCond=function(form,context){for(var predicate,exprs=form.value.slice(1),i=0;i<exprs.length;i+=2)if(null!==(predicate=evaluateExpression(exprs[i],context)).value&&!1!==predicate.value)return exprs[i+1]},SpecialForms.fn=function(form,context){return{params:form.value[1],exprs:form.value[2],program_defined:!0,context:context,quoted:!1}},SpecialForms.def=function(form,context){var name=form.value[1],form=form.value[2],form=void 0===form?literal(null):evaluateExpression(form,context);namespace_1.Namespace.current.set(name.value,form)},SpecialForms.let=function(form,context){var i,param,value,bindings=form.value[1],form=form.value[2];if(bindings.value.length%2!=0)throw new Error("let requires an even number of forms in binding vector");for(i=0;i<bindings.value.length;i+=2)param=bindings.value[i].value,value=evaluateExpression(bindings.value[i+1],context),context.set(param,value);return evaluateExpression(form,context)},SpecialForms.throw=function(form,context){form=form.value[1];throw new Error(evaluateExpression(form,context))},SpecialForms.try=function(form,context){var exprs=form.value[1],catchClause=form.value[2],form=form.value[3];try{return evaluateExpression(exprs,context)}catch(error){return evaluateExpression(catchClause,context)}finally{void 0!==form&&evaluateExpression(form,context)}},SpecialForms}();function lookupQualifiedSymbol(name,namespace){if(void 0!==namespace){if(void 0===namespace_1.Namespace.get(namespace))throw new Error("No such namespace: "+namespace);return namespace_1.Namespace.get(namespace).get(name)}}function lookupSpecialForm(name,namespace){return void 0===namespace&&"function"==typeof(namespace=SpecialForms[name])?namespace:void 0}function lookupContextSymbol(name,namespace,context){if(void 0!==context.get(name))return context.get(name)}function lookupWindowSymbol(name){if("undefined"!=typeof window&&void 0!==window[name])return function(){return window[name].apply(window,arguments)}}function lookupGlobalSymbol(name){if(void 0!==global&&void 0!==global[name])return function(){return global[name].apply(global,arguments)}}function throwLookupError(name,namespace,context){if(void 0!==namespace)throw new Error("No such var: "+namespace+"/"+name);throw new Error("Unable to resolve symbol: "+name+" in this context")}exports.SpecialForms=SpecialForms,Array.prototype.map=Array.prototype.map||function(f){for(var result=[],i=0;i<this.length;++i)result.push(f(this[i],i,this));return result},Array.prototype.find=Array.prototype.find||function(f){for(var i=0;i<this.length;++i)if(f(this[i]))return this[i]};Evaluator=new Evaluator;exports.evaluator=Evaluator}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./events":3,"./forms":5,"./namespace":6}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.events=void 0;var EventSystem=function(){function EventSystem(){this.subscribers={}}return EventSystem.prototype.publish=function(event,data){event=this.subscribers[event];if(!event||0===event.length)return!1;for(var _i=0,queue_1=event;_i<queue_1.length;_i++)(0,queue_1[_i])(data);return!0},EventSystem.prototype.subscribe=function(event,callback){return this.subscribers[event]||(this.subscribers[event]=[]),this.subscribers[event].push(callback),callback},EventSystem.prototype.unsubscribe=function(event,callback){this.subscribers[event]&&(this.subscribers[event]=callback?this.subscribers[event].filter(function(subCb){return subCb!==callback}):void 0)},EventSystem}();exports.events=new EventSystem},{}],4:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Form=void 0;var Form=function(){function Form(kind,namespace,value,openChr,closeChr,terminal,quoted){void 0===openChr&&(openChr=""),void 0===closeChr&&(closeChr=""),void 0===terminal&&(terminal=!0),void 0===quoted&&(quoted=!1),this.kind=kind,this.namespace=namespace,this.value=value,this.openChr=openChr,this.closeChr=closeChr,this.terminal=terminal,this.quoted=quoted,this.kind=kind,this.namespace=namespace,this.value=value,this.openChr=openChr,this.closeChr=closeChr,this.terminal=terminal,this.quoted=!1}return Form.prototype.stringify=function(){var value=this.isTerminal()?this.value:this.value.map(function(t){try{return t.stringify()}catch(e){return t}}).join(" ");return"".concat(this.openChr||"").concat(value).concat(this.closeChr||"")},Form.prototype.isTerminal=function(){return!1!==this.terminal},Form.prototype.toString=function(){return this.stringify()},Form}();exports.Form=Form},{}],5:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.forms=void 0;var form_1=require("./form"),require="a-z\\*\\+\\!\\-\\_\\?\\.\\~\\@",SYM_TAIL=require+"0-9",require={number:createFormGenerator("number",/^(')?\d+/),string:createFormGenerator("string",/^'?"(([^\\"]|\\\\|\\")*)/,'"','"'),literal:createFormGenerator("literal",/^'?(true|false|nil)$/),symbol:createFormGenerator("symbol",new RegExp("^'?(?:(["+require+"]["+SYM_TAIL+"]*)\\/)?(["+require+"\\/|=]["+SYM_TAIL+"]*)","i")),keyword:createFormGenerator("keyword",new RegExp("^'?::?(?:(["+require+"]["+SYM_TAIL+"]*)\\/)?(["+require+"=]["+SYM_TAIL+"]*)","i"),":"),vector:createFormGenerator("vector",/^('?)\[/,"[","]",!1),hash_map:createFormGenerator("hash_map",/^('?)\{/,"{","}",!1),call:createFormGenerator("call",/^('?)\(/,"(",")",!1),list:createFormGenerator("list",/^(['`])?\(/,"(",")",!1),comment:createFormGenerator("comment",/^;.*?(\n|$)/)};function createFormGenerator(kind,pattern,openChr,closeChr,terminal){function generator(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var namespace=!1!==terminal&&2===args.length?args.shift():void 0,value=!1===terminal?args:args.shift();return new form_1.Form(kind,namespace,value,openChr,closeChr,terminal)}return generator.kind=kind,generator.pattern=pattern,generator.closeChr=closeChr,generator}exports.forms=require},{"./form":4}],6:[function(require,module,exports){!function(__dirname){!function(){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Namespace=void 0;var events_1=require("./events"),Namespace=function(){function Namespace(name){this.vars={},this.name=name,this.vars={}}return Namespace.prototype.use=function(ns){for(var _i=0,_a=Object.entries(ns.vars);_i<_a.length;_i++){var _b=_a[_i],name_1=_b[0],_b=_b[1];this.set(name_1,_b)}},Namespace.prototype.get=function(name){return this.vars[name]},Namespace.prototype.set=function(name,value){this.vars[name]=value},Namespace.prototype.extend=function(){var ns=new Namespace;return ns.vars=Object.create(this.vars),ns},Namespace.get=function(name){return Namespace.all[name]},Namespace.set=function(name){var namespace,core;Namespace.all[name]||(namespace=new Namespace(name),core=require(__dirname+"/clojure/core").core,namespace.use(core),Namespace.all[name]=namespace),Namespace.current=Namespace.all[name]},Namespace.reset=function(){Namespace.all=[],Namespace.set("user"),events_1.events.publish("NAMESPACES_RESET",null)},Namespace.all=[],Namespace}();(exports.Namespace=Namespace).reset()}.call(this)}.call(this,"/src")},{"./events":3}],7:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Reader=void 0;var forms_1=require("./forms"),formParsers={number:function(match,cursor){cursor.pos+=match[0].length-1;cursor="'"===match[1]||"`"===match[1]?+match[0].substr(1):+match[0];return forms_1.forms.number(cursor)},string:function(match,cursor){return cursor.pos+=match[0].length,forms_1.forms.string(match[1])},symbol:function(match,cursor){if(cursor.pos+=match[0].length-1,function(match){return void 0===match[1]&&forms_1.forms.literal.pattern.exec(match[0])}(match))return forms_1.forms.literal(match[2]);return forms_1.forms.symbol(match[1],match[2])},keyword:function(match,cursor){return cursor.pos+=match[0].length-1,forms_1.forms.keyword(match[1],match[2])},vector:function(match,cursor,str){return cursor.pos+=match[0].length,forms_1.forms.vector.apply(forms_1.forms,parseExpressions(str,cursor,forms_1.forms.vector.closeChr))},hash_map:function(match,cursor,str){return cursor.pos+=match[0].length,forms_1.forms.hash_map.apply(forms_1.forms,parseExpressions(str,cursor,forms_1.forms.hash_map.closeChr))},list:function(match,cursor,str){cursor.pos+=match[0].length;match="'"===match[1]||"`"===match[1],str=parseExpressions(str,cursor,forms_1.forms.list.closeChr),cursor=(!match&&0<str.length?forms_1.forms.call:forms_1.forms.list).apply(forms_1.forms,str);return cursor.quoted=match,cursor},comment:function(match,cursor){return cursor.pos+=match[0].length,null}},require=function(){function Reader(){}return Reader.prototype.read=function(str){return parseExpressions(str)},Reader}();function parseExpressions(str,cursor,closeChr){var formKind,match,currentChar,expressions=[];for(cursor=cursor||{pos:0};cursor.pos<str.length;cursor.pos++){for(formKind in currentChar=str[cursor.pos],formParsers)if(forms_1.forms.hasOwnProperty(formKind)&&(match=forms_1.forms[formKind].pattern.exec(str.substr(cursor.pos)))){(match=formParsers[formKind](match,cursor,str))&&expressions.push(match);break}if(currentChar===closeChr)break}return expressions}exports.Reader=require},{"./forms":5}]},{},[1]);
