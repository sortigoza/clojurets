!function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);throw(f=new Error("Cannot find module '"+i+"'")).code="MODULE_NOT_FOUND",f}c=n[i]={exports:{}},e[i][0].call(c.exports,function(r){return o(e[i][1][r]||r)},c,c.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.maps=void 0;var forms_1=require("../forms");function hash_map_fn(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var quotedList=forms_1.forms.hash_map.apply(this,args);return quotedList.quoted=!0,quotedList}hash_map_fn.macro=!0,exports.maps={get:function(map,k){for(var index=0;index<map.value.length;index+=2)if(k.kind===map.value[index].kind&&k.value===map.value[index].value)return map.value[index+1]},keys:function(map){for(var values=[],index=0;index<map.value.length;index+=2)values.push(map.value[index]);return forms_1.forms.list.apply(this,values)},vals:function(map){for(var values=[],index=1;index<map.value.length;index+=2)values.push(map.value[index]);return forms_1.forms.list.apply(this,values)},"hash-map":hash_map_fn}},{"../forms":16}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.collections=void 0;var evaluator_1=require("../evaluator"),forms_1=require("../forms");function list_fn(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var quotedList=forms_1.forms.list.apply(this,args);return quotedList.quoted=!0,quotedList}list_fn.macro=!0,exports.collections={first:function(list){return evaluator_1.evaluator.evaluate([list.value[0]])},second:function(list){return evaluator_1.evaluator.evaluate([list.value[1]])},nth:function(list,n){return evaluator_1.evaluator.evaluate([list.value[n]])},rest:function(list){return list.value.splice(0,1),list},list:list_fn}},{"../evaluator":13,"../forms":16}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.defn=exports.partial=void 0;var forms_1=require("../forms"),evaluator_1=require("../evaluator"),namespace_1=require("../namespace"),literal=forms_1.forms.literal;function defn(name,args,exprs){namespace_1.Namespace.current.set(name.value,evaluator_1.SpecialForms.fn({value:["",args,exprs]},this))}exports.partial=function(){var func=arguments[0],args=Array.prototype.slice.call(arguments,1);return function(){var context=this;return function(){var result;return Array.prototype.map.call(arguments,function(a){args.push(a)}),null==(result=func.apply(context,args))?literal(null):result}.apply(context,arguments)}},(exports.defn=defn).macro=!0},{"../evaluator":13,"../forms":16,"../namespace":17}],4:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.println=void 0,exports.println=function(){console.log.apply(console,arguments)}},{}],5:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.assert=exports.defmacro=void 0;var evaluator_1=require("../evaluator"),namespace_1=require("../namespace");function defmacro(name,params,list){var context=this;function macro(){return function(){var expandedList={kind:"call",value:[]},extArgs=arguments;return expandedList.value=list.value.map(function(expr){for(var i=0;i<params.value.length;i++){var param=params.value[i];if(expr.value===param.value)return extArgs[i]}return expr}),evaluator_1.evaluator.evaluate([expandedList],context)}.apply(context,arguments)}macro.macro=!0,namespace_1.Namespace.current.set(name.value,macro)}function assert(condition){function errorString(condition,extrainfo){return"Assert failed: "+condition.stringify()+(void 0!==extrainfo?"; "+extrainfo:"")}try{if(!0!==evaluator_1.evaluator.evaluate([condition]).value)throw new Error(errorString(condition))}catch(e){if(e.constructedByAssert)throw e;throw new Error(errorString(condition,e.message))}}(exports.defmacro=defmacro).macro=!0,(exports.assert=assert).macro=!0},{"../evaluator":13,"../namespace":17}],6:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.misc=void 0;var require=require("../forms"),literal=require.forms.literal,string=require.forms.string,number=require.forms.number,keyword=require.forms.keyword;exports.misc={"=":function equals(){for(var args=Array.prototype.slice.call(arguments,0),i=0;i<args.length-1;i++){var form=args[i],nextForm=args[i+1],stringNumOrKeyword=function(form){return form.kind===string.kind||form.kind===number.kind||form.kind===keyword.kind};if(stringNumOrKeyword(form)||stringNumOrKeyword(nextForm)){if(form.kind!==nextForm.kind||form.value!==nextForm.value)return literal(!1)}else{if(form.value.length!==nextForm.value.length)return literal(!1);for(var j=0;j<form.value.length;j++)if(!equals(form.value[j],nextForm.value[j]).value)return literal(!1)}}return literal(!0)}}},{"../forms":16}],7:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.namespace=void 0;var namespace_1=require("../namespace");function ns(name){namespace_1.Namespace.set(name.value)}ns.macro=!0,exports.namespace={ns:ns}},{"../namespace":17}],8:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.arithmetic=void 0;var number=require("../forms").forms.number;exports.arithmetic={"+":function(){var sum=0;return Array.prototype.map.call(arguments,function(n){sum+=n.value}),number(sum)},"-":function(){var sum=arguments[0];return Array.prototype.map.call(Array.prototype.slice.call(arguments,1),function(n){sum-=n.value}),number(sum)},"*":function(){var product=1;return Array.prototype.map.call(arguments,function(n){product*=n.value}),number(product)},"/":function(){var product=arguments[0];return Array.prototype.map.call(Array.prototype.slice.call(arguments,1),function(n){product/=n.value}),number(product)},mod:function(dividend,divisor){return number(dividend.value%divisor.value)}}},{"../forms":16}],9:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.numbers_test=void 0;var literal=require("../forms").forms.literal;exports.numbers_test={"odd?":function(n){return literal(n%2==1)},"even?":function(n){return literal(n%2==0)}}},{"../forms":16}],10:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.cons=exports.concat=exports.map=void 0;var list=require("../forms").forms.list;function cons(element,list){return list.value.splice(0,0,element),list}exports.map=function(f,coll){return"list"===coll.kind?Array.prototype.map.call(coll.value,function(elem){return f(elem.value)}):coll.value.map(f)},exports.concat=function(){var concatList=[];return Array.prototype.map.call(arguments,function(coll){concatList=concatList.concat(coll.value)}),list.apply(this,concatList)},(exports.cons=cons).macro=!0},{"../forms":16}],11:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&("get"in desc?m.__esModule:!desc.writable&&!desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},namespace_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.core=void 0,require("../namespace")),core_collections_lists_1=require("./core.collections.lists"),core_primitives_numbers_arithmetic_1=require("./core.primitives.numbers.arithmetic"),functions=__importStar(require("./core.functions")),coreIO=__importStar(require("./core.io")),macros=__importStar(require("./core.macros")),core_namespace_1=require("./core.namespace"),__importStar=__importStar(require("./core.sequences")),core_primitives_numbers_test_1=require("./core.primitives.numbers.test"),core_misc_1=require("./core.misc"),require=require("./core.collections.hash_maps"),core=new namespace_1.Namespace("clojure.core");function use(vars){for(var name_1 in vars)core.set(name_1,vars[name_1])}exports.core=core,use(core_collections_lists_1.collections),use(core_primitives_numbers_arithmetic_1.arithmetic),use(core_primitives_numbers_test_1.numbers_test),use(functions),use(__importStar),use(core_misc_1.misc),use(macros),use(coreIO),use(core_namespace_1.namespace),use(require.maps)},{"../namespace":17,"./core.collections.hash_maps":1,"./core.collections.lists":2,"./core.functions":3,"./core.io":4,"./core.macros":5,"./core.misc":6,"./core.namespace":7,"./core.primitives.numbers.arithmetic":8,"./core.primitives.numbers.test":9,"./core.sequences":10}],12:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.clojure=void 0;var reader_1=require("./reader"),evaluator_1=require("./evaluator"),events_1=require("./events"),require=require("./namespace"),reader=new reader_1.Reader;exports.clojure={run:function(str){return str=reader.read(str),events_1.events.publish("BEGIN_RUN_EVALUATION",{data:str}),str=evaluator_1.evaluator.evaluate(str),events_1.events.publish("FINISH_RUN_EVALUATION",{result:str}),str},events:events_1.events,namespace:require.Namespace},"undefined"!=typeof window&&(window.clojurejs=exports.clojure)},{"./evaluator":13,"./events":14,"./namespace":17,"./reader":18}],13:[function(require,module,exports){!function(global){!function(){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.evaluator=exports.SpecialForms=void 0;var namespace_1=require("./namespace"),forms_1=require("./forms"),events_1=require("./events"),literal=(forms_1.forms.number,forms_1.forms.string,forms_1.forms.literal),symbol=forms_1.forms.symbol,hash_map=forms_1.forms.hash_map,vector=forms_1.forms.vector,call=(forms_1.forms.list,forms_1.forms.call),MAX_ITERATIONS=1e3,Evaluator=function(){function Evaluator(){}return Evaluator.prototype.evaluate=function(exprs,context){context=context||namespace_1.Namespace.current;for(var _i=0,exprs_1=exprs;_i<exprs_1.length;_i++)var result=evaluateExpression(exprs_1[_i],context);return void 0===result?literal(null):result},Evaluator}();function evaluateExpression(form,context){return function(fn,form,context){try{events_1.events.publish("BEGIN_EVALUATE_EXPRESSION",{form:form,context:context});var result=fn(form,context);return events_1.events.publish("FINISH_EVALUATE_EXPRESSION",{form:form,context:context,result:result}),result}catch(e){throw events_1.events.publish("EVALUATE_EXPRESSION_FAILED",{form:form,context:context}),e}}(_evaluateExpression,form,context)}function _evaluateExpression(form,context){for(var should_continue,name,count=0;;){if(form.quoted)return form;switch(form.kind){case literal.kind:return literal("true"===(name=form.value)||"false"!==name&&("nil"===name?null:void 0));case symbol.kind:return function(name,namespace,context){var symbol;return[lookupQualifiedSymbol,lookupSpecialForm,lookupContextSymbol,lookupWindowSymbol,lookupGlobalSymbol,throwLookupError].find(function(lookup){return void 0!==(symbol=lookup.call(this,name,namespace,context))}),symbol}(form.value,form.namespace,context);case vector.kind:return vector.apply(forms_1.forms,form.value.map(function(e){return evaluateExpression(e,context)}));case hash_map.kind:return hash_map.apply(forms_1.forms,form.value.map(function(e){return evaluateExpression(e,context)}));case call.kind:switch(form.value[0].value){case"if":form=SpecialForms.tailCallIf(form,context);continue;case"cond":form=SpecialForms.tailCallCond(form,context);continue;case"fn":return SpecialForms.fn(form,context);case"def":return SpecialForms.def(form,context);case"let":return SpecialForms.let(form,context.extend());case"throw":return SpecialForms.throw(form,context);case"try":return SpecialForms.try(form,context)}if(form=(name=function(form,context){var func=evaluateExpression(form.value[0],context),args=form.value.slice(1);func.macro||(args=args.map(function(arg){return evaluateExpression(arg,context)}));if(func.program_defined)return func.params.value.map(function(arg,i){context.set(arg.value,args[i])}),void 0===(form=func.exprs)?[literal(null),!1,context]:[form,!0,context];return[("function"==typeof func?func:func.value).apply(context,args),!1,context]}(form,context.extend()))[0],should_continue=name[1],context=name[2],should_continue&&count<MAX_ITERATIONS){count++;continue}return count===MAX_ITERATIONS&&console.log({msg:"max evaluations reached!",count:count}),form;default:return form}}}var SpecialForms=function(){function SpecialForms(){}return SpecialForms.tailCallIf=function(form,context){context=evaluateExpression(form.value[1],context);return null!==context.value&&!1!==context.value?form.value[2]:form.value[3]},SpecialForms.tailCallCond=function(form,context){for(var predicate,exprs=form.value.slice(1),i=0;i<exprs.length;i+=2)if(null!==(predicate=evaluateExpression(exprs[i],context)).value&&!1!==predicate.value)return exprs[i+1]},SpecialForms.fn=function(form,context){return{params:form.value[1],exprs:form.value[2],program_defined:!0,context:context,quoted:!1}},SpecialForms.def=function(form,context){var name=form.value[1],form=form.value[2],form=void 0===form?literal(null):evaluateExpression(form,context);namespace_1.Namespace.current.set(name.value,form)},SpecialForms.let=function(form,context){var i,param,value,bindings=form.value[1],form=form.value[2];if(bindings.value.length%2!=0)throw new Error("let requires an even number of forms in binding vector");for(i=0;i<bindings.value.length;i+=2)param=bindings.value[i].value,value=evaluateExpression(bindings.value[i+1],context),context.set(param,value);return evaluateExpression(form,context)},SpecialForms.throw=function(form,context){form=form.value[1];throw new Error(evaluateExpression(form,context))},SpecialForms.try=function(form,context){var exprs=form.value[1],catchClause=form.value[2],form=form.value[3];try{return evaluateExpression(exprs,context)}catch(error){return evaluateExpression(catchClause,context)}finally{void 0!==form&&evaluateExpression(form,context)}},SpecialForms}();function lookupQualifiedSymbol(name,namespace){if(void 0!==namespace){if(void 0===namespace_1.Namespace.get(namespace))throw new Error("No such namespace: "+namespace);return namespace_1.Namespace.get(namespace).get(name)}}function lookupSpecialForm(name,namespace){return void 0===namespace&&"function"==typeof(namespace=SpecialForms[name])?namespace:void 0}function lookupContextSymbol(name,namespace,context){if(void 0!==context.get(name))return context.get(name)}function lookupWindowSymbol(name){if("undefined"!=typeof window&&void 0!==window[name])return function(){return window[name].apply(window,arguments)}}function lookupGlobalSymbol(name){if(void 0!==global&&void 0!==global[name])return function(){return global[name].apply(global,arguments)}}function throwLookupError(name,namespace,context){if(void 0!==namespace)throw new Error("No such var: "+namespace+"/"+name);throw new Error("Unable to resolve symbol: "+name+" in this context")}exports.SpecialForms=SpecialForms,Array.prototype.map=Array.prototype.map||function(f){for(var result=[],i=0;i<this.length;++i)result.push(f(this[i],i,this));return result},Array.prototype.find=Array.prototype.find||function(f){for(var i=0;i<this.length;++i)if(f(this[i]))return this[i]};Evaluator=new Evaluator;exports.evaluator=Evaluator}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./events":14,"./forms":16,"./namespace":17}],14:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.events=void 0;var EventSystem=function(){function EventSystem(){this.subscribers={}}return EventSystem.prototype.publish=function(event,data){event=this.subscribers[event];if(!event||0===event.length)return!1;for(var _i=0,queue_1=event;_i<queue_1.length;_i++)(0,queue_1[_i])(data);return!0},EventSystem.prototype.subscribe=function(event,callback){return this.subscribers[event]||(this.subscribers[event]=[]),this.subscribers[event].push(callback),callback},EventSystem.prototype.unsubscribe=function(event,callback){this.subscribers[event]&&(this.subscribers[event]=callback?this.subscribers[event].filter(function(subCb){return subCb!==callback}):void 0)},EventSystem}();exports.events=new EventSystem},{}],15:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Form=void 0;var Form=function(){function Form(kind,namespace,value,openChr,closeChr,terminal,stringifyRep){this.kind=kind,this.namespace=namespace,this.value=value,this.openChr=openChr,this.closeChr=closeChr,this.terminal=terminal,this.quoted=!1}return Form.prototype.stringify=function(){var value=this.isTerminal()?this.value:this.value.map(function(t){try{return t.stringify()}catch(e){return t}}).join(" ");return(this.openChr||"")+value+(this.closeChr||"")},Form.prototype.isTerminal=function(){return!1!==this.terminal},Form.prototype.toString=function(){return this.stringify()},Form}();exports.Form=Form},{}],16:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.forms=void 0;var form_1=require("./form"),require="a-z\\*\\+\\!\\-\\_\\?\\.\\~\\@",SYM_TAIL=require+"0-9",require={number:createFormGenerator("number",/^(')?\d+/),string:createFormGenerator("string",/^'?"(([^\\"]|\\\\|\\")*)/,'"','"'),literal:createFormGenerator("literal",/^'?(true|false|nil)$/),symbol:createFormGenerator("symbol",new RegExp("^'?(?:(["+require+"]["+SYM_TAIL+"]*)\\/)?(["+require+"\\/|=]["+SYM_TAIL+"]*)","i")),keyword:createFormGenerator("keyword",new RegExp("^'?::?(?:(["+require+"]["+SYM_TAIL+"]*)\\/)?(["+require+"=]["+SYM_TAIL+"]*)","i"),":"),vector:createFormGenerator("vector",/^('?)\[/,"[","]",!1),hash_map:createFormGenerator("hash_map",/^('?)\{/,"{","}",!1),call:createFormGenerator("call",/^('?)\(/,"(",")",!1),list:createFormGenerator("list",/^(['`])?\(/,"(",")",!1),comment:createFormGenerator("comment",/^;.*?(\n|$)/)};function createFormGenerator(kind,pattern,openChr,closeChr,terminal){function generator(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var namespace=!1!==terminal&&2===args.length?args.shift():void 0,value=!1===terminal?args:args.shift();return new form_1.Form(kind,namespace,value,openChr,closeChr,terminal)}return generator.kind=kind,generator.pattern=pattern,generator.closeChr=closeChr,generator}exports.forms=require},{"./form":15}],17:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Namespace=void 0;var events_1=require("./events"),Namespace=function(){function Namespace(name){this.name=name,this.vars={}}return Namespace.prototype.use=function(ns){for(var name in ns.vars)this.set(name,ns.get(name))},Namespace.prototype.get=function(name){return this.vars[name]},Namespace.prototype.set=function(name,value){this.vars[name]=value},Namespace.prototype.extend=function(){var ns=new Namespace;function Vars(){}return Vars.prototype=this.vars,ns.vars=new Vars,ns},Namespace.get=function(name){return Namespace.all[name]},Namespace.set=function(name){var namespace,core;Namespace.all[name]||(namespace=new Namespace(name),core=require("./clojure/core").core,namespace.use(core),Namespace.all[name]=namespace),Namespace.current=Namespace.all[name]},Namespace.reset=function(){Namespace.all=[],Namespace.set("user"),events_1.events.publish("NAMESPACES_RESET",null)},Namespace.all=[],Namespace}();(exports.Namespace=Namespace).reset()},{"./clojure/core":11,"./events":14}],18:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Reader=void 0;var forms_1=require("./forms"),formParsers={number:function(match,cursor){cursor.pos+=match[0].length-1;cursor="'"===match[1]||"`"===match[1]?+match[0].substr(1):+match[0];return forms_1.forms.number(cursor)},string:function(match,cursor){return cursor.pos+=match[0].length,forms_1.forms.string(match[1])},symbol:function(match,cursor){if(cursor.pos+=match[0].length-1,function(match){return void 0===match[1]&&forms_1.forms.literal.pattern.exec(match[0])}(match))return forms_1.forms.literal(match[2]);return forms_1.forms.symbol(match[1],match[2])},keyword:function(match,cursor){return cursor.pos+=match[0].length-1,forms_1.forms.keyword(match[1],match[2])},vector:function(match,cursor,str){return cursor.pos+=match[0].length,forms_1.forms.vector.apply(forms_1.forms,parseExpressions(str,cursor,forms_1.forms.vector.closeChr))},hash_map:function(match,cursor,str){return cursor.pos+=match[0].length,forms_1.forms.hash_map.apply(forms_1.forms,parseExpressions(str,cursor,forms_1.forms.hash_map.closeChr))},list:function(match,cursor,str){cursor.pos+=match[0].length;match="'"===match[1]||"`"===match[1],str=parseExpressions(str,cursor,forms_1.forms.list.closeChr),cursor=(!match&&0<str.length?forms_1.forms.call:forms_1.forms.list).apply(forms_1.forms,str);return cursor.quoted=match,cursor},comment:function(match,cursor){return cursor.pos+=match[0].length,null}},require=function(){function Reader(){}return Reader.prototype.read=function(str){return parseExpressions(str)},Reader}();function parseExpressions(str,cursor,closeChr){var formKind,match,currentChar,expressions=[];for(cursor=cursor||{pos:0};cursor.pos<str.length;cursor.pos++){for(formKind in currentChar=str[cursor.pos],formParsers)if(forms_1.forms.hasOwnProperty(formKind)&&(match=forms_1.forms[formKind].pattern.exec(str.substr(cursor.pos)))){(match=formParsers[formKind](match,cursor,str))&&expressions.push(match);break}if(currentChar===closeChr)break}return expressions}exports.Reader=require},{"./forms":16}]},{},[12]);
